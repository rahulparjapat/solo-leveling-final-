<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="SSC Solo Leveling - Professional Study Tracker for SSC CGL/CHSL/MTS/GD">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SSC Solo Leveling</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%231a1a2e' width='100' height='100' rx='20'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='%234a9eff'>S</text></svg>">
    <style>
        /* ===== CSS VARIABLES & RESET ===== */
        :root {
            --bg-primary: #0d0d14;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #252540;
            --bg-card: #16162a;
            --text-primary: #e8e8f0;
            --text-secondary: #a0a0b8;
            --text-muted: #6a6a80;
            --accent-blue: #4a9eff;
            --accent-green: #4ade80;
            --accent-yellow: #fbbf24;
            --accent-red: #ef4444;
            --accent-purple: #a78bfa;
            --border-color: #2a2a45;
            --shadow: 0 4px 20px rgba(0,0,0,0.4);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: 200ms ease;
            --font-stack: 'Inter', 'Roboto', 'Arial', system-ui, sans-serif;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-stack);
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes progressFill {
            from { width: 0; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }

        .animate-fadeIn { animation: fadeIn 300ms ease forwards; }
        .animate-slideUp { animation: slideUp 300ms ease forwards; }
        .animate-scaleIn { animation: scaleIn 200ms ease forwards; }
        .animate-shake { animation: shake 300ms ease; }

        .stagger-1 { animation-delay: 50ms; }
        .stagger-2 { animation-delay: 100ms; }
        .stagger-3 { animation-delay: 150ms; }
        .stagger-4 { animation-delay: 200ms; }
        .stagger-5 { animation-delay: 250ms; }

        /* ===== SKELETON LOADER ===== */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--bg-secondary) 50%, var(--bg-tertiary) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-sm);
        }

        /* ===== LAYOUT ===== */
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        @media (min-width: 768px) {
            .app-container {
                max-width: 600px;
            }
        }

        /* ===== HEADER ===== */
        .header {
            background: var(--bg-secondary);
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .header-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .header-stats {
            display: flex;
            gap: 16px;
        }

        .header-stat {
            text-align: right;
        }

        .header-stat-value {
            font-size: 1rem;
            font-weight: 600;
        }

        .header-stat-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .xp-color { color: var(--accent-blue); }
        .gold-color { color: var(--accent-yellow); }

        /* ===== NAVIGATION ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 100;
        }

        @media (min-width: 768px) {
            .bottom-nav {
                max-width: 600px;
            }
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.65rem;
            transition: var(--transition);
            cursor: pointer;
            border: none;
            background: none;
        }

        .nav-item:hover, .nav-item.active {
            color: var(--accent-blue);
        }

        .nav-item svg {
            width: 22px;
            height: 22px;
            margin-bottom: 4px;
        }

        .nav-item.active svg {
            filter: drop-shadow(0 0 6px var(--accent-blue));
        }

        /* ===== PAGES ===== */
        .page {
            display: none;
            padding: 20px;
            animation: fadeIn 250ms ease;
        }

        .page.active {
            display: block;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .page-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        /* ===== CARDS ===== */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
            animation: slideUp 300ms ease forwards;
            opacity: 0;
            transition: transform var(--transition), box-shadow var(--transition);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .card-badge {
            font-size: 0.7rem;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 500;
        }

        .badge-blue { background: rgba(74, 158, 255, 0.15); color: var(--accent-blue); }
        .badge-green { background: rgba(74, 222, 128, 0.15); color: var(--accent-green); }
        .badge-yellow { background: rgba(251, 191, 36, 0.15); color: var(--accent-yellow); }
        .badge-red { background: rgba(239, 68, 68, 0.15); color: var(--accent-red); }
        .badge-purple { background: rgba(167, 139, 250, 0.15); color: var(--accent-purple); }

        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: transform 150ms ease, box-shadow 150ms ease, background 150ms ease;
            font-family: inherit;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #3a8eef;
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-card);
        }

        .btn-success {
            background: var(--accent-green);
            color: #0d0d14;
        }

        .btn-danger {
            background: var(--accent-red);
            color: white;
        }

        .btn-full {
            width: 100%;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.8rem;
        }

        /* ===== INPUTS ===== */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: inherit;
            transition: border-color var(--transition);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23a0a0b8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
        }

        /* ===== PROGRESS BARS ===== */
        .progress-container {
            margin: 16px 0;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            border-radius: 4px;
            transition: width 500ms ease;
            animation: progressFill 800ms ease;
        }

        .progress-fill.green { background: linear-gradient(90deg, var(--accent-green), #22c55e); }
        .progress-fill.yellow { background: linear-gradient(90deg, var(--accent-yellow), #f59e0b); }
        .progress-fill.red { background: linear-gradient(90deg, var(--accent-red), #dc2626); }

        /* ===== MODAL ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 20px;
            animation: fadeIn 200ms ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            animation: scaleIn 200ms ease;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            font-size: 1.5rem;
            line-height: 1;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* ===== DASHBOARD SPECIFIC ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .rank-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-bottom: 20px;
        }

        .rank-badge {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: 3px solid var(--accent-blue);
        }

        .rank-info h3 {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }

        .rank-info p {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .daily-mock-card {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-tertiary));
            border: 2px solid var(--accent-purple);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .daily-mock-card h3 {
            color: var(--accent-purple);
            font-size: 0.9rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .daily-mock-subject {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 12px;
        }

        /* ===== STUDY SESSION ===== */
        .study-phase {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .phase-option {
            padding: 12px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .phase-option:hover {
            border-color: var(--accent-blue);
        }

        .phase-option.selected {
            border-color: var(--accent-blue);
            background: rgba(74, 158, 255, 0.1);
        }

        .phase-option h4 {
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .phase-option p {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .camera-container {
            position: relative;
            width: 100%;
            aspect-ratio: 4/3;
            background: var(--bg-tertiary);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 16px;
        }

        .camera-container video, .camera-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.5);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .camera-overlay svg {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
        }

        /* ===== QUEST/HABIT LIST ===== */
        .list-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .list-item:hover {
            border-color: var(--accent-blue);
        }

        .list-item.completed {
            opacity: 0.6;
            border-color: var(--accent-green);
        }

        .list-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: var(--transition);
        }

        .list-checkbox.checked {
            background: var(--accent-green);
            border-color: var(--accent-green);
        }

        .list-checkbox svg {
            display: none;
            width: 14px;
            height: 14px;
            color: white;
        }

        .list-checkbox.checked svg {
            display: block;
        }

        .list-content {
            flex: 1;
        }

        .list-title {
            font-size: 0.95rem;
            margin-bottom: 2px;
        }

        .list-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .list-action {
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
        }

        .list-action:hover {
            color: var(--accent-red);
        }

        /* ===== SKILL TREE ===== */
        .skill-tree-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .skill-tab {
            padding: 10px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            white-space: nowrap;
            cursor: pointer;
            transition: var(--transition);
        }

        .skill-tab.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: white;
        }

        .skill-node {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-bottom: 12px;
        }

        .skill-icon {
            width: 48px;
            height: 48px;
            background: var(--bg-tertiary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .skill-info {
            flex: 1;
        }

        .skill-name {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .skill-hours {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .skill-level {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--accent-blue);
        }

        /* ===== MOCK SECTION ===== */
        .mock-type-card {
            padding: 20px;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            margin-bottom: 16px;
            cursor: pointer;
            transition: var(--transition);
        }

        .mock-type-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }

        .mock-type-card.boss {
            border-color: var(--accent-yellow);
            background: linear-gradient(135deg, var(--bg-card), rgba(251, 191, 36, 0.1));
        }

        .mock-type-card h3 {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .mock-type-card p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .mock-rewards {
            display: flex;
            gap: 16px;
            font-size: 0.8rem;
        }

        .mock-rewards span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* ===== AWAKENING ===== */
        .vision-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .vision-card.anti {
            border-color: var(--accent-red);
            background: linear-gradient(135deg, var(--bg-card), rgba(239, 68, 68, 0.05));
        }

        .vision-card h3 {
            font-size: 1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .vision-text {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.7;
            white-space: pre-wrap;
        }

        /* ===== REWARDS ===== */
        .reward-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-bottom: 12px;
        }

        .reward-item.unlocked {
            border-color: var(--accent-green);
        }

        .reward-item.locked {
            opacity: 0.5;
        }

        .reward-icon {
            width: 50px;
            height: 50px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .reward-info {
            flex: 1;
        }

        .reward-name {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .reward-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .reward-cost {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--accent-yellow);
        }

        /* ===== STUDY HISTORY ===== */
        .history-item {
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-bottom: 12px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .history-date {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .history-xp {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent-blue);
        }

        .history-subject {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .history-details {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* ===== REPORT ===== */
        .report-summary {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .report-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .report-row:last-child {
            border-bottom: none;
        }

        .report-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .report-value {
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* ===== ONBOARDING ===== */
        .onboarding-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
        }

        .onboarding-logo {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .onboarding-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .onboarding-subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 40px;
        }

        .exam-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 30px;
        }

        .exam-option {
            padding: 20px;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .exam-option:hover, .exam-option.selected {
            border-color: var(--accent-blue);
        }

        .exam-option.selected {
            background: rgba(74, 158, 255, 0.1);
        }

        .exam-option h3 {
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .exam-option p {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* ===== STREAK & FAILURE ===== */
        .streak-display {
            display: flex;
            gap: 20px;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-bottom: 20px;
        }

        .streak-item {
            flex: 1;
            text-align: center;
        }

        .streak-value {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .streak-value.success {
            color: var(--accent-green);
        }

        .streak-value.danger {
            color: var(--accent-red);
        }

        .streak-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        /* ===== TOAST ===== */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 300;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
            width: calc(100% - 40px);
        }

        .toast {
            padding: 14px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            animation: slideUp 300ms ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toast.success {
            border-color: var(--accent-green);
        }

        .toast.error {
            border-color: var(--accent-red);
        }

        .toast.warning {
            border-color: var(--accent-yellow);
        }

        .toast-message {
            flex: 1;
            font-size: 0.9rem;
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .empty-state svg {
            width: 60px;
            height: 60px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .empty-state p {
            font-size: 0.85rem;
        }

        /* ===== TIMER ===== */
        .timer-display {
            font-size: 3rem;
            font-weight: 700;
            text-align: center;
            font-variant-numeric: tabular-nums;
            margin: 20px 0;
            color: var(--accent-blue);
        }

        .timer-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* ===== MISC ===== */
        .divider {
            height: 1px;
            background: var(--border-color);
            margin: 20px 0;
        }

        .text-center { text-align: center; }
        .text-muted { color: var(--text-muted); }
        .mb-2 { margin-bottom: 8px; }
        .mb-4 { margin-bottom: 16px; }
        .mt-4 { margin-top: 16px; }

        .flex { display: flex; }
        .flex-between { justify-content: space-between; }
        .flex-center { align-items: center; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }

        .hidden { display: none !important; }

        /* Print styles for PDF */
        @media print {
            body {
                background: white;
                color: black;
            }
            .bottom-nav, .header, .btn, .modal-overlay {
                display: none !important;
            }
            .app-container {
                max-width: 100%;
                padding: 20px;
            }
            .card, .stat-card, .report-summary {
                background: white;
                border: 1px solid #ddd;
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Onboarding Screen -->
    <div id="onboardingScreen" class="onboarding-container">
        <div class="onboarding-logo">üìö</div>
        <h1 class="onboarding-title">SSC Solo Leveling</h1>
        <p class="onboarding-subtitle">Professional Study Tracker<br>Time = Effort | Consistency = Rank</p>
        
        <h2 style="font-size: 1rem; margin-bottom: 16px; color: var(--text-secondary);">Select Your Exam</h2>
        <div class="exam-options">
            <div class="exam-option" data-exam="CGL">
                <h3>CGL</h3>
                <p>Combined Graduate Level</p>
            </div>
            <div class="exam-option" data-exam="CHSL">
                <h3>CHSL</h3>
                <p>Combined Higher Secondary</p>
            </div>
            <div class="exam-option" data-exam="MTS">
                <h3>MTS</h3>
                <p>Multi Tasking Staff</p>
            </div>
            <div class="exam-option" data-exam="GD">
                <h3>GD</h3>
                <p>General Duty Constable</p>
            </div>
        </div>
        
        <button class="btn btn-primary btn-full" id="startJourney" disabled>Begin Your Journey</button>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div>
                    <div class="header-title">SSC Solo Leveling</div>
                    <div class="header-subtitle" id="headerExam">CGL Preparation</div>
                </div>
                <div class="header-stats">
                    <div class="header-stat">
                        <div class="header-stat-value xp-color" id="headerXP">0</div>
                        <div class="header-stat-label">XP</div>
                    </div>
                    <div class="header-stat">
                        <div class="header-stat-value gold-color" id="headerGold">0</div>
                        <div class="header-stat-label">Gold</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- App Container -->
        <div class="app-container">
            <!-- Dashboard Page -->
            <div id="pageDashboard" class="page active">
                <h1 class="page-title">Dashboard</h1>
                
                <!-- Rank Display -->
                <div class="rank-display card stagger-1">
                    <div class="rank-badge" id="rankBadge">E</div>
                    <div class="rank-info">
                        <h3 id="rankTitle">Beginner</h3>
                        <p id="levelDisplay">Level 1</p>
                    </div>
                </div>

                <!-- Daily Mock Quest -->
                <div class="daily-mock-card card stagger-2">
                    <h3>‚öîÔ∏è Daily Sectional Mock</h3>
                    <p class="daily-mock-subject" id="dailyMockSubject">Quantitative Aptitude</p>
                    <div id="dailyMockStatus">
                        <button class="btn btn-primary btn-sm" onclick="openDailyMockModal()">Complete Mock</button>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card card stagger-3">
                        <div class="stat-value xp-color" id="totalXP">0</div>
                        <div class="stat-label">Total XP</div>
                    </div>
                    <div class="stat-card card stagger-3">
                        <div class="stat-value gold-color" id="totalGold">0</div>
                        <div class="stat-label">Gold</div>
                    </div>
                    <div class="stat-card card stagger-4">
                        <div class="stat-value" id="studyHours">0h</div>
                        <div class="stat-label">Study Hours</div>
                    </div>
                    <div class="stat-card card stagger-4">
                        <div class="stat-value" id="weeklyXP">0/300</div>
                        <div class="stat-label">Weekly XP</div>
                    </div>
                </div>

                <!-- XP Progress -->
                <div class="card stagger-5">
                    <div class="progress-container">
                        <div class="progress-header">
                            <span>Level Progress</span>
                            <span id="xpToNext">0 / 100 XP</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="xpProgressBar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Streak & Failure -->
                <div class="streak-display card">
                    <div class="streak-item">
                        <div class="streak-value success" id="streakCount">0</div>
                        <div class="streak-label">Day Streak</div>
                    </div>
                    <div class="streak-item">
                        <div class="streak-value danger" id="failureCount">0</div>
                        <div class="streak-label">Failures</div>
                    </div>
                    <div class="streak-item">
                        <div class="streak-value" id="protectionStatus">‚ùå</div>
                        <div class="streak-label">Protected</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <button class="btn btn-primary btn-full" onclick="navigateTo('study')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>
                    Start Verified Study
                </button>
            </div>

            <!-- Study Page -->
            <div id="pageStudy" class="page">
                <h1 class="page-title">Verified Study</h1>
                
                <!-- Study Session Flow -->
                <div id="studyIntent">
                    <div class="card">
                        <h3 class="card-title mb-4">üìù Step 1: Set Your Intent</h3>
                        
                        <div class="form-group">
                            <label class="form-label">Subject</label>
                            <select class="form-select" id="studySubject">
                                <option value="">Select Subject</option>
                                <option value="Quantitative Aptitude">Quantitative Aptitude</option>
                                <option value="English Language">English Language</option>
                                <option value="Reasoning Ability">Reasoning Ability</option>
                                <option value="General Awareness">General Awareness</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Topic</label>
                            <input type="text" class="form-input" id="studyTopic" placeholder="e.g., Percentage, Idioms, Syllogism">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Study Phase</label>
                            <div class="study-phase">
                                <div class="phase-option" data-phase="Learning" data-rate="20">
                                    <h4>Learning</h4>
                                    <p>20 XP/hr</p>
                                </div>
                                <div class="phase-option" data-phase="Revision" data-rate="15">
                                    <h4>Revision</h4>
                                    <p>15 XP/hr</p>
                                </div>
                                <div class="phase-option" data-phase="Mock Analysis" data-rate="25">
                                    <h4>Mock Analysis</h4>
                                    <p>25 XP/hr</p>
                                </div>
                                <div class="phase-option" data-phase="Mock Attempt" data-rate="30">
                                    <h4>Mock Attempt</h4>
                                    <p>30 XP/hr</p>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Expected Duration (minutes)</label>
                            <input type="number" class="form-input" id="studyDuration" placeholder="e.g., 60" min="20">
                        </div>

                        <button class="btn btn-primary btn-full" onclick="startStudySession()">Take Photo & Start</button>
                    </div>
                </div>

                <!-- Photo Capture -->
                <div id="studyPhoto" class="hidden">
                    <div class="card">
                        <h3 class="card-title mb-4">üì∏ Step 2: Photo Evidence</h3>
                        <div class="camera-container">
                            <video id="cameraPreview" autoplay playsinline></video>
                            <img id="capturedPhoto" class="hidden">
                            <div class="camera-overlay" id="cameraOverlay">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
                                <span>Tap to capture</span>
                            </div>
                        </div>
                        <div id="photoActions" class="hidden">
                            <div class="flex gap-3">
                                <button class="btn btn-secondary" onclick="retakePhoto()">Retake</button>
                                <button class="btn btn-primary" style="flex:1" onclick="confirmPhoto()">Confirm & Start Timer</button>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-full" id="captureBtn" onclick="capturePhoto()">Capture Photo</button>
                    </div>
                </div>

                <!-- Active Session -->
                <div id="studyActive" class="hidden">
                    <div class="card">
                        <h3 class="card-title mb-2">‚è±Ô∏è Study in Progress</h3>
                        <p class="text-muted mb-4" id="activeSessionInfo">Quantitative Aptitude - Percentage</p>
                        <div class="timer-display" id="studyTimer">00:00:00</div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill green" id="sessionProgress" style="width: 0%"></div>
                            </div>
                        </div>
                        <p class="text-center text-muted mb-4" id="sessionPhase">Learning Phase ‚Ä¢ 20 XP/hr</p>
                        <button class="btn btn-success btn-full" onclick="endStudySession()">Complete Session</button>
                    </div>
                </div>

                <!-- Confirmation -->
                <div id="studyConfirm" class="hidden">
                    <div class="card">
                        <h3 class="card-title mb-4">‚úÖ Step 3: Session Reflection</h3>
                        
                        <div class="form-group">
                            <label class="form-label">What did you study?</label>
                            <textarea class="form-textarea" id="reflectionContent" placeholder="Summarize what you learned..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">One difficulty you faced</label>
                            <input type="text" class="form-input" id="reflectionDifficulty" placeholder="e.g., Ratio word problems">
                        </div>

                        <div class="form-group">
                            <label class="form-label">One point to revise</label>
                            <input type="text" class="form-input" id="reflectionRevision" placeholder="e.g., Time-speed-distance formulas">
                        </div>

                        <div class="card" style="background: var(--bg-tertiary)">
                            <p class="text-muted mb-2">Session Summary</p>
                            <p id="sessionSummary">Duration: 0 min | Potential XP: 0</p>
                        </div>

                        <button class="btn btn-success btn-full mt-4" onclick="submitStudySession()">Submit & Earn XP</button>
                    </div>
                </div>

                <!-- Study History -->
                <div class="divider"></div>
                <h2 style="font-size: 1.1rem; margin-bottom: 16px;">Recent Sessions</h2>
                <div id="studyHistory"></div>
            </div>

            <!-- Quests Page -->
            <div id="pageQuests" class="page">
                <h1 class="page-title">Quests</h1>
                <p class="page-subtitle">Create study tasks. Complete for 20 XP & 5 Gold each.</p>

                <button class="btn btn-primary btn-full mb-4" onclick="openQuestModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    Add New Quest
                </button>

                <div id="questList"></div>
            </div>

            <!-- Skill Trees Page -->
            <div id="pageSkills" class="page">
                <h1 class="page-title">Skill Trees</h1>
                <p class="page-subtitle">Track mastery across SSC subjects</p>

                <div class="skill-tree-tabs" id="skillTabs">
                    <div class="skill-tab active" data-subject="Quantitative Aptitude">Quant</div>
                    <div class="skill-tab" data-subject="English Language">English</div>
                    <div class="skill-tab" data-subject="Reasoning Ability">Reasoning</div>
                    <div class="skill-tab" data-subject="General Awareness">GA</div>
                </div>

                <div id="skillContent"></div>
            </div>

            <!-- Habits Page -->
            <div id="pageHabits" class="page">
                <h1 class="page-title">Habits</h1>
                <p class="page-subtitle">Build consistency. Creating a habit gives 20 XP & 5 Gold.</p>

                <button class="btn btn-primary btn-full mb-4" onclick="openHabitModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    Add New Habit
                </button>

                <div id="habitList"></div>
            </div>

            <!-- Mocks Page -->
            <div id="pageMocks" class="page">
                <h1 class="page-title">Mock Tests</h1>
                <p class="page-subtitle">Sectional & Full Mocks for rank protection</p>

                <div class="mock-type-card" onclick="openSectionalMockModal()">
                    <h3>üìã Sectional Mock</h3>
                    <p>Complete a single subject mock test. Provides partial rank protection.</p>
                    <div class="mock-rewards">
                        <span class="xp-color">30 XP/hr</span>
                        <span class="gold-color">+ Gold</span>
                    </div>
                </div>

                <div class="mock-type-card boss" onclick="openFullMockModal()">
                    <h3>‚öîÔ∏è Full Mock (Boss Battle)</h3>
                    <p>Complete a full-length SSC mock. Grants FULL rank protection for the day.</p>
                    <div class="mock-rewards">
                        <span class="xp-color">High XP</span>
                        <span class="gold-color">+ Gold</span>
                        <span style="color: var(--accent-green)">üõ°Ô∏è Full Protection</span>
                    </div>
                </div>

                <div class="divider"></div>
                <h2 style="font-size: 1.1rem; margin-bottom: 16px;">Mock History</h2>
                <div id="mockHistory"></div>
            </div>

            <!-- Rewards Page -->
            <div id="pageRewards" class="page">
                <h1 class="page-title">Rewards</h1>
                <p class="page-subtitle">Milestones unlocked through consistency</p>

                <div id="rewardsList"></div>
            </div>

            <!-- Awakening Page -->
            <div id="pageAwakening" class="page">
                <h1 class="page-title">Awakening</h1>
                <p class="page-subtitle">Your vision drives your discipline</p>

                <div class="vision-card">
                    <h3>üéØ Vision Statement</h3>
                    <p class="vision-text" id="visionText">Click to set your vision...</p>
                    <button class="btn btn-secondary btn-sm mt-4" onclick="openVisionModal('vision')">Edit Vision</button>
                </div>

                <div class="vision-card anti">
                    <h3>‚ö†Ô∏è Anti-Vision</h3>
                    <p class="vision-text" id="antiVisionText">What happens if you fail...</p>
                    <button class="btn btn-secondary btn-sm mt-4" onclick="openVisionModal('anti')">Edit Anti-Vision</button>
                </div>

                <div class="card">
                    <h3 class="card-title mb-4">üìä Journey Statistics</h3>
                    <div class="report-row">
                        <span class="report-label">Started On</span>
                        <span class="report-value" id="journeyStart">-</span>
                    </div>
                    <div class="report-row">
                        <span class="report-label">Days Active</span>
                        <span class="report-value" id="daysActive">0</span>
                    </div>
                    <div class="report-row">
                        <span class="report-label">Best Streak</span>
                        <span class="report-value" id="bestStreak">0 days</span>
                    </div>
                </div>
            </div>

            <!-- Report Page -->
            <div id="pageReport" class="page">
                <h1 class="page-title">Study Report</h1>
                <p class="page-subtitle">Full audit from Day 1 to today</p>

                <div class="report-summary">
                    <div class="report-row">
                        <span class="report-label">Tracking Since</span>
                        <span class="report-value" id="reportStartDate">-</span>
                    </div>
                    <div class="report-row">
                        <span class="report-label">Current Level</span>
                        <span class="report-value" id="reportLevel">1</span>
                    </div>
                    <div class="report-row">
                        <span class="report-label">Current Rank</span>
                        <span class="report-value" id="reportRank">E - Beginner</span>
                    </div>
                    <div class="report-row">
                        <span class="report-label">Total XP</span>
                        <span class="report-value xp-color" id="reportXP">0</span>
                    </div>
                    <div class="report-row">
                        <span class="report-label">Total Gold</span>
                        <span class="report-value gold-color" id="reportGold">0</span>
                    </div>
                    <div class="report-row">
                        <span class="report-label">Current Streak</span>
                        <span class="report-value" id="reportStreak">0</span>
                    </div>
                    <div class="report-row">
                        <span class="report-label">Total Failures</span>
                        <span class="report-value" id="reportFailures">0</span>
                    </div>
                    <div class="report-row">
                        <span class="report-label">Verified Study Hours</span>
                        <span class="report-value" id="reportHours">0</span>
                    </div>
                </div>

                <button class="btn btn-primary btn-full" onclick="exportPDF()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Export Full Report (PDF)
                </button>

                <div class="divider"></div>
                <h2 style="font-size: 1.1rem; margin-bottom: 16px;">Complete Study History</h2>
                <div id="fullHistory"></div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="dashboard">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>
                Home
            </button>
            <button class="nav-item" data-page="study">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>
                Study
            </button>
            <button class="nav-item" data-page="quests">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                Quests
            </button>
            <button class="nav-item" data-page="mocks">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>
                Mocks
            </button>
            <button class="nav-item" data-page="more">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
                More
            </button>
        </nav>

        <!-- More Menu Modal -->
        <div class="modal-overlay" id="moreMenuModal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title">More Options</h3>
                    <button class="modal-close" onclick="closeModal('moreMenuModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <button class="btn btn-secondary btn-full mb-2" onclick="navigateTo('skills'); closeModal('moreMenuModal')">üìä Skill Trees</button>
                    <button class="btn btn-secondary btn-full mb-2" onclick="navigateTo('habits'); closeModal('moreMenuModal')">üîÑ Habits</button>
                    <button class="btn btn-secondary btn-full mb-2" onclick="navigateTo('rewards'); closeModal('moreMenuModal')">üèÜ Rewards</button>
                    <button class="btn btn-secondary btn-full mb-2" onclick="navigateTo('awakening'); closeModal('moreMenuModal')">üéØ Awakening</button>
                    <button class="btn btn-secondary btn-full" onclick="navigateTo('report'); closeModal('moreMenuModal')">üìã Study Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quest Modal -->
    <div class="modal-overlay" id="questModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add Quest</h3>
                <button class="modal-close" onclick="closeModal('questModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Quest Title</label>
                    <input type="text" class="form-input" id="questTitle" placeholder="e.g., Solve 20 percentage problems">
                </div>
                <div class="form-group">
                    <label class="form-label">Subject</label>
                    <select class="form-select" id="questSubject">
                        <option value="Quantitative Aptitude">Quantitative Aptitude</option>
                        <option value="English Language">English Language</option>
                        <option value="Reasoning Ability">Reasoning Ability</option>
                        <option value="General Awareness">General Awareness</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('questModal')">Cancel</button>
                <button class="btn btn-primary" onclick="addQuest()">Add Quest</button>
            </div>
        </div>
    </div>

    <!-- Habit Modal -->
    <div class="modal-overlay" id="habitModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add Habit</h3>
                <button class="modal-close" onclick="closeModal('habitModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Habit Name</label>
                    <input type="text" class="form-input" id="habitName" placeholder="e.g., Read newspaper daily">
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-select" id="habitCategory">
                        <option value="Study">Study</option>
                        <option value="Revision">Revision</option>
                        <option value="Health">Health</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('habitModal')">Cancel</button>
                <button class="btn btn-primary" onclick="addHabit()">Add Habit (+20 XP)</button>
            </div>
        </div>
    </div>

    <!-- Daily Mock Modal -->
    <div class="modal-overlay" id="dailyMockModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Daily Sectional Mock</h3>
                <button class="modal-close" onclick="closeModal('dailyMockModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p class="mb-4">Subject: <strong id="mockModalSubject">Quantitative Aptitude</strong></p>
                
                <div class="camera-container">
                    <video id="mockCameraPreview" autoplay playsinline></video>
                    <img id="mockCapturedPhoto" class="hidden">
                    <div class="camera-overlay" id="mockCameraOverlay">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
                        <span>Photo proof of mock attempt</span>
                    </div>
                </div>
                <button class="btn btn-secondary btn-full mb-4" id="mockCaptureBtn" onclick="captureMockPhoto()">Capture Photo</button>

                <div class="form-group">
                    <label class="form-label">Duration (minutes)</label>
                    <input type="number" class="form-input" id="mockDuration" placeholder="e.g., 30" min="15">
                </div>

                <div class="form-group">
                    <label class="form-label">Score/Accuracy (if known)</label>
                    <input type="text" class="form-input" id="mockScore" placeholder="e.g., 18/25 or 72%">
                </div>

                <div class="form-group">
                    <label class="form-label">Weak Areas</label>
                    <input type="text" class="form-input" id="mockWeakArea" placeholder="e.g., Profit & Loss, Time-Work">
                </div>

                <div class="form-group">
                    <label class="form-label">Correction Plan</label>
                    <textarea class="form-textarea" id="mockCorrectionPlan" placeholder="How will you improve?"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('dailyMockModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitDailyMock()">Submit Mock</button>
            </div>
        </div>
    </div>

    <!-- Sectional Mock Modal -->
    <div class="modal-overlay" id="sectionalMockModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Log Sectional Mock</h3>
                <button class="modal-close" onclick="closeModal('sectionalMockModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Subject</label>
                    <select class="form-select" id="sectionalSubject">
                        <option value="Quantitative Aptitude">Quantitative Aptitude</option>
                        <option value="English Language">English Language</option>
                        <option value="Reasoning Ability">Reasoning Ability</option>
                        <option value="General Awareness">General Awareness</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Duration (minutes)</label>
                    <input type="number" class="form-input" id="sectionalDuration" placeholder="e.g., 30" min="15">
                </div>

                <div class="form-group">
                    <label class="form-label">Score/Accuracy</label>
                    <input type="text" class="form-input" id="sectionalScore" placeholder="e.g., 18/25">
                </div>

                <div class="form-group">
                    <label class="form-label">Reflection</label>
                    <textarea class="form-textarea" id="sectionalReflection" placeholder="Key takeaways..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('sectionalMockModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitSectionalMock()">Log Mock</button>
            </div>
        </div>
    </div>

    <!-- Full Mock Modal -->
    <div class="modal-overlay" id="fullMockModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">‚öîÔ∏è Full Mock (Boss Battle)</h3>
                <button class="modal-close" onclick="closeModal('fullMockModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Mock Name/Source</label>
                    <input type="text" class="form-input" id="fullMockName" placeholder="e.g., SSC CGL Tier 1 - Set 5">
                </div>

                <div class="form-group">
                    <label class="form-label">Duration (minutes)</label>
                    <input type="number" class="form-input" id="fullMockDuration" placeholder="e.g., 60" min="30">
                </div>

                <div class="form-group">
                    <label class="form-label">Total Score</label>
                    <input type="text" class="form-input" id="fullMockScore" placeholder="e.g., 145/200">
                </div>

                <div class="form-group">
                    <label class="form-label">Subject-wise Analysis</label>
                    <textarea class="form-textarea" id="fullMockAnalysis" placeholder="Quant: 35/50, English: 40/50..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Key Learnings</label>
                    <textarea class="form-textarea" id="fullMockLearnings" placeholder="What will you focus on next?"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('fullMockModal')">Cancel</button>
                <button class="btn btn-success" onclick="submitFullMock()">Complete Boss Battle</button>
            </div>
        </div>
    </div>

    <!-- Vision Modal -->
    <div class="modal-overlay" id="visionModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="visionModalTitle">Edit Vision</h3>
                <button class="modal-close" onclick="closeModal('visionModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" id="visionModalLabel">Your Vision</label>
                    <textarea class="form-textarea" id="visionInput" style="min-height: 150px" placeholder="Write your vision here..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('visionModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveVision()">Save</button>
            </div>
        </div>
    </div>

    <script>
        // ===== APP STATE =====
        const APP_VERSION = '1.0.0';
        const SSC_SUBJECTS = ['Quantitative Aptitude', 'English Language', 'Reasoning Ability', 'General Awareness'];
        const PHASE_RATES = { 'Learning': 20, 'Revision': 15, 'Mock Analysis': 25, 'Mock Attempt': 30 };
        const RANK_THRESHOLDS = [
            { rank: 'E', title: 'Beginner', minXP: 0 },
            { rank: 'D', title: 'Serious', minXP: 500 },
            { rank: 'C', title: 'Consistent', minXP: 1500 },
            { rank: 'B', title: 'Exam-Ready', minXP: 4000 },
            { rank: 'A', title: 'Elite', minXP: 10000 },
            { rank: 'S', title: 'Selection Zone', minXP: 25000 }
        ];
        const REWARDS = [
            { id: 1, name: 'First Steps', desc: 'Complete first verified study', icon: 'üéØ', requirement: 'firstStudy' },
            { id: 2, name: 'Quest Hunter', desc: 'Complete 10 quests', icon: '‚öîÔ∏è', requirement: 'quests10' },
            { id: 3, name: 'Week Warrior', desc: '7 day streak', icon: 'üî•', requirement: 'streak7' },
            { id: 4, name: 'Century Club', desc: 'Reach 100 XP', icon: 'üíØ', requirement: 'xp100' },
            { id: 5, name: 'Mock Master', desc: 'Complete 5 full mocks', icon: 'üìù', requirement: 'mocks5' },
            { id: 6, name: 'Subject Expert', desc: '10 hours in one subject', icon: 'üß†', requirement: 'subject10h' },
            { id: 7, name: 'Level 5', desc: 'Reach Level 5', icon: '‚≠ê', requirement: 'level5' },
            { id: 8, name: 'Rank D', desc: 'Achieve Rank D', icon: 'üèÖ', requirement: 'rankD' },
            { id: 9, name: 'Month Strong', desc: '30 day streak', icon: 'üí™', requirement: 'streak30' },
            { id: 10, name: 'Rank S', desc: 'Achieve Selection Zone', icon: 'üëë', requirement: 'rankS' }
        ];

        let state = {
            initialized: false,
            exam: null,
            startDate: null,
            xp: 0,
            level: 1,
            streak: 0,
            bestStreak: 0,
            failureCount: 0,
            consecutiveFailures: 0,
            lastActiveDate: null,
            weekStartDate: null,
            weeklyXP: 0,
            rolloverXP: 0,
            todayStudied: false,
            todayMockDone: false,
            todayProtection: 'none',
            lastMockDate: null,
            dailyMockSubject: null,
            lastDailyMockSubject: null,
            vision: '',
            antiVision: '',
            studySessions: [],
            quests: [],
            habits: [],
            mocks: [],
            skills: {},
            unlockedRewards: [],
            currentSession: null
        };

        // ===== INITIALIZATION =====
        function init() {
            loadState();
            
            if (!state.initialized) {
                document.getElementById('onboardingScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
                setupOnboarding();
            } else {
                document.getElementById('onboardingScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                checkDayChange();
                renderAll();
            }

            setupNavigation();
            setupPhaseSelection();
            setupSkillTabs();

            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed:', err));
            }
        }

        function setupOnboarding() {
            const options = document.querySelectorAll('.exam-option');
            const startBtn = document.getElementById('startJourney');
            let selectedExam = null;

            options.forEach(opt => {
                opt.addEventListener('click', () => {
                    options.forEach(o => o.classList.remove('selected'));
                    opt.classList.add('selected');
                    selectedExam = opt.dataset.exam;
                    startBtn.disabled = false;
                });
            });

            startBtn.addEventListener('click', () => {
                if (selectedExam) {
                    state.initialized = true;
                    state.exam = selectedExam;
                    state.startDate = new Date().toISOString();
                    state.lastActiveDate = getDateString();
                    state.weekStartDate = getDateString();
                    initializeSkills();
                    generateDailyMock();
                    saveState();
                    
                    document.getElementById('onboardingScreen').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    renderAll();
                    showToast('Welcome to your SSC journey!', 'success');
                }
            });
        }

        function initializeSkills() {
            SSC_SUBJECTS.forEach(subject => {
                state.skills[subject] = { hours: 0, level: 1 };
            });
        }

        // ===== STATE MANAGEMENT =====
        function loadState() {
            const saved = localStorage.getItem('ssc_solo_leveling_state');
            if (saved) {
                state = { ...state, ...JSON.parse(saved) };
            }
        }

        function saveState() {
            localStorage.setItem('ssc_solo_leveling_state', JSON.stringify(state));
        }

        function getDateString(date = new Date()) {
            return date.toISOString().split('T')[0];
        }

        // ===== DAY CHANGE LOGIC =====
        function checkDayChange() {
            const today = getDateString();
            
            if (state.lastActiveDate !== today) {
                // Apply penalties for missed day
                if (state.lastActiveDate) {
                    const lastDate = new Date(state.lastActiveDate);
                    const todayDate = new Date(today);
                    const daysMissed = Math.floor((todayDate - lastDate) / (1000 * 60 * 60 * 24));
                    
                    if (daysMissed > 0) {
                        for (let i = 0; i < daysMissed; i++) {
                            applyDailyPenalty();
                        }
                    }
                }
                
                // Reset daily flags
                state.todayStudied = false;
                state.todayMockDone = false;
                state.todayProtection = 'none';
                
                // Check weekly reset
                checkWeeklyReset();
                
                // Generate new daily mock
                generateDailyMock();
                
                state.lastActiveDate = today;
                saveState();
            }
        }

        function checkWeeklyReset() {
            if (!state.weekStartDate) {
                state.weekStartDate = getDateString();
                return;
            }
            
            const weekStart = new Date(state.weekStartDate);
            const today = new Date();
            const daysSince = Math.floor((today - weekStart) / (1000 * 60 * 60 * 24));
            
            if (daysSince >= 7) {
                // Calculate rollover
                const excess = Math.max(0, state.weeklyXP - 300);
                state.rolloverXP = Math.min(excess, 100);
                state.weeklyXP = state.rolloverXP;
                state.weekStartDate = getDateString();
            }
        }

        function applyDailyPenalty() {
            state.consecutiveFailures++;
            state.failureCount++;
            state.streak = 0;
            
            // XP Penalty based on consecutive failures
            if (state.consecutiveFailures === 1) {
                modifyXP(-25, 'Day 1 Failure Penalty');
            } else if (state.consecutiveFailures === 2) {
                modifyXP(-50, 'Day 2 Failure Penalty');
            } else {
                // Force level and rank downgrade
                modifyXP(-100, 'Day 3+ Failure - Severe Penalty');
                if (state.level > 1) {
                    state.level--;
                    showToast('Level downgraded due to consistent failure!', 'error');
                }
            }
            
            // XP Decay based on level
            applyXPDecay();
        }

        function applyXPDecay() {
            let decay = 0;
            if (state.level >= 11) decay = 50;
            else if (state.level >= 9) decay = 35;
            else if (state.level >= 7) decay = 20;
            else if (state.level >= 5) decay = 10;
            
            if (decay > 0) {
                modifyXP(-decay, 'Daily XP Decay');
            }
        }

        function generateDailyMock() {
            let available = SSC_SUBJECTS.filter(s => s !== state.lastDailyMockSubject);
            state.dailyMockSubject = available[Math.floor(Math.random() * available.length)];
        }

        // ===== XP & GOLD SYSTEM =====
        function calculateGold(xp) {
            return Math.floor(xp / 4);
        }

        function getTotalGold() {
            return calculateGold(state.xp);
        }

        function modifyXP(amount, reason = '') {
            const oldXP = state.xp;
            state.xp = Math.max(0, state.xp + amount);
            
            // Weekly cap check (only for positive XP)
            if (amount > 0) {
                const potentialWeekly = state.weeklyXP + amount;
                if (potentialWeekly > 300) {
                    const capped = 300 - state.weeklyXP;
                    state.weeklyXP = 300;
                    showToast(`Weekly XP cap reached! ${amount - capped} XP will roll over.`, 'warning');
                } else {
                    state.weeklyXP += amount;
                }
            }
            
            // Recalculate level
            calculateLevel();
            saveState();
            
            if (amount > 0) {
                const goldEarned = calculateGold(amount);
                console.log(`${reason}: +${amount} XP, +${goldEarned} Gold`);
            }
        }

        function calculateLevel() {
            // Level XP thresholds: 0, 100, 200, 400, 800, 1600...
            let level = 1;
            let threshold = 100;
            let totalNeeded = 0;
            
            while (state.xp >= totalNeeded + threshold) {
                totalNeeded += threshold;
                level++;
                threshold *= 2;
            }
            
            state.level = level;
        }

        function getXPForLevel(level) {
            if (level <= 1) return 0;
            let total = 0;
            let threshold = 100;
            for (let i = 2; i <= level; i++) {
                total += threshold;
                threshold *= 2;
            }
            return total;
        }

        function getXPToNextLevel() {
            const currentLevelXP = getXPForLevel(state.level);
            const nextLevelXP = getXPForLevel(state.level + 1);
            return {
                current: state.xp - currentLevelXP,
                needed: nextLevelXP - currentLevelXP,
                total: nextLevelXP
            };
        }

        function getRank() {
            for (let i = RANK_THRESHOLDS.length - 1; i >= 0; i--) {
                if (state.xp >= RANK_THRESHOLDS[i].minXP) {
                    return RANK_THRESHOLDS[i];
                }
            }
            return RANK_THRESHOLDS[0];
        }

        // ===== NAVIGATION =====
        function setupNavigation() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const page = item.dataset.page;
                    if (page === 'more') {
                        openModal('moreMenuModal');
                    } else {
                        navigateTo(page);
                    }
                });
            });
        }

        function navigateTo(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            const pageEl = document.getElementById('page' + page.charAt(0).toUpperCase() + page.slice(1));
            if (pageEl) {
                pageEl.classList.add('active');
            }
            
            const navItem = document.querySelector(`.nav-item[data-page="${page}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // Refresh page-specific content
            if (page === 'skills') renderSkillTree();
            if (page === 'report') renderReport();
        }

        // ===== MODALS =====
        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            // Stop any camera streams
            stopCamera();
        }

        // ===== TOAST NOTIFICATIONS =====
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span class="toast-message">${message}</span>`;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ===== STUDY SESSION =====
        let cameraStream = null;
        let studyTimerInterval = null;
        let studyStartTime = null;

        function setupPhaseSelection() {
            document.querySelectorAll('.phase-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    document.querySelectorAll('.phase-option').forEach(o => o.classList.remove('selected'));
                    opt.classList.add('selected');
                });
            });
        }

        function startStudySession() {
            const subject = document.getElementById('studySubject').value;
            const topic = document.getElementById('studyTopic').value;
            const phaseEl = document.querySelector('.phase-option.selected');
            const duration = parseInt(document.getElementById('studyDuration').value);
            
            if (!subject || !topic || !phaseEl || !duration) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            if (duration < 20) {
                showToast('Minimum session is 20 minutes', 'error');
                return;
            }
            
            state.currentSession = {
                subject,
                topic,
                phase: phaseEl.dataset.phase,
                rate: parseInt(phaseEl.dataset.rate),
                expectedDuration: duration,
                startTime: null,
                photo: null
            };
            
            document.getElementById('studyIntent').classList.add('hidden');
            document.getElementById('studyPhoto').classList.remove('hidden');
            
            startCamera('cameraPreview', 'cameraOverlay');
        }

        async function startCamera(videoId, overlayId) {
            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                const video = document.getElementById(videoId);
                video.srcObject = cameraStream;
                document.getElementById(overlayId).classList.add('hidden');
            } catch (err) {
                showToast('Camera access denied. Please enable camera.', 'error');
                console.error(err);
            }
        }

        function stopCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
        }

        function capturePhoto() {
            const video = document.getElementById('cameraPreview');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            const photo = canvas.toDataURL('image/jpeg', 0.7);
            state.currentSession.photo = photo;
            
            document.getElementById('capturedPhoto').src = photo;
            document.getElementById('capturedPhoto').classList.remove('hidden');
            video.classList.add('hidden');
            document.getElementById('captureBtn').classList.add('hidden');
            document.getElementById('photoActions').classList.remove('hidden');
            
            stopCamera();
        }

        function retakePhoto() {
            document.getElementById('capturedPhoto').classList.add('hidden');
            document.getElementById('cameraPreview').classList.remove('hidden');
            document.getElementById('captureBtn').classList.remove('hidden');
            document.getElementById('photoActions').classList.add('hidden');
            
            startCamera('cameraPreview', 'cameraOverlay');
        }

        function confirmPhoto() {
            if (!state.currentSession.photo) {
                showToast('Please capture a photo first', 'error');
                return;
            }
            
            state.currentSession.startTime = Date.now();
            studyStartTime = Date.now();
            
            document.getElementById('studyPhoto').classList.add('hidden');
            document.getElementById('studyActive').classList.remove('hidden');
            
            document.getElementById('activeSessionInfo').textContent = 
                `${state.currentSession.subject} - ${state.currentSession.topic}`;
            document.getElementById('sessionPhase').textContent = 
                `${state.currentSession.phase} Phase ‚Ä¢ ${state.currentSession.rate} XP/hr`;
            
            startStudyTimer();
        }

        function startStudyTimer() {
            studyTimerInterval = setInterval(() => {
                const elapsed = Date.now() - studyStartTime;
                const seconds = Math.floor(elapsed / 1000);
                const mins = Math.floor(seconds / 60);
                const hrs = Math.floor(mins / 60);
                
                document.getElementById('studyTimer').textContent = 
                    `${String(hrs).padStart(2, '0')}:${String(mins % 60).padStart(2, '0')}:${String(seconds % 60).padStart(2, '0')}`;
                
                const progress = Math.min(100, (mins / state.currentSession.expectedDuration) * 100);
                document.getElementById('sessionProgress').style.width = `${progress}%`;
            }, 1000);
        }

        function endStudySession() {
            clearInterval(studyTimerInterval);
            
            const elapsed = Date.now() - studyStartTime;
            const minutes = Math.floor(elapsed / 60000);
            
            if (minutes < 20) {
                showToast('Minimum 20 minutes required for valid session', 'error');
                resetStudyUI();
                return;
            }
            
            state.currentSession.actualDuration = minutes;
            
            const potentialXP = Math.floor((minutes / 60) * state.currentSession.rate);
            document.getElementById('sessionSummary').textContent = 
                `Duration: ${minutes} min | Potential XP: ${potentialXP}`;
            
            document.getElementById('studyActive').classList.add('hidden');
            document.getElementById('studyConfirm').classList.remove('hidden');
        }

        function submitStudySession() {
            const content = document.getElementById('reflectionContent').value;
            const difficulty = document.getElementById('reflectionDifficulty').value;
            const revision = document.getElementById('reflectionRevision').value;
            
            if (!content || !difficulty || !revision) {
                showToast('Please complete all reflection fields', 'error');
                return;
            }
            
            const session = state.currentSession;
            const minutes = session.actualDuration;
            const xpEarned = Math.floor((minutes / 60) * session.rate);
            const goldEarned = calculateGold(xpEarned);
            
            // Record session
            const record = {
                id: Date.now(),
                date: new Date().toISOString(),
                subject: session.subject,
                topic: session.topic,
                phase: session.phase,
                expectedDuration: session.expectedDuration,
                actualDuration: minutes,
                photo: session.photo,
                reflection: { content, difficulty, revision },
                xp: xpEarned,
                gold: goldEarned
            };
            
            state.studySessions.push(record);
            
            // Update skills
            if (!state.skills[session.subject]) {
                state.skills[session.subject] = { hours: 0, level: 1 };
            }
            state.skills[session.subject].hours += minutes / 60;
            updateSkillLevel(session.subject);
            
            // Award XP
            modifyXP(xpEarned, `Study: ${session.topic}`);
            
            // Update daily status
            state.todayStudied = true;
            state.consecutiveFailures = 0;
            state.streak++;
            if (state.streak > state.bestStreak) {
                state.bestStreak = state.streak;
            }
            
            saveState();
            showToast(`+${xpEarned} XP, +${goldEarned} Gold earned!`, 'success');
            
            // Check rewards
            checkRewards();
            
            resetStudyUI();
            renderAll();
        }

        function resetStudyUI() {
            document.getElementById('studyIntent').classList.remove('hidden');
            document.getElementById('studyPhoto').classList.add('hidden');
            document.getElementById('studyActive').classList.add('hidden');
            document.getElementById('studyConfirm').classList.add('hidden');
            
            document.getElementById('studySubject').value = '';
            document.getElementById('studyTopic').value = '';
            document.getElementById('studyDuration').value = '';
            document.querySelectorAll('.phase-option').forEach(o => o.classList.remove('selected'));
            document.getElementById('reflectionContent').value = '';
            document.getElementById('reflectionDifficulty').value = '';
            document.getElementById('reflectionRevision').value = '';
            
            state.currentSession = null;
            stopCamera();
        }

        function updateSkillLevel(subject) {
            const hours = state.skills[subject].hours;
            // Level up every 5 hours
            state.skills[subject].level = Math.floor(hours / 5) + 1;
        }

        // ===== QUESTS =====
        function openQuestModal() {
            document.getElementById('questTitle').value = '';
            openModal('questModal');
        }

        function addQuest() {
            const title = document.getElementById('questTitle').value;
            const subject = document.getElementById('questSubject').value;
            
            if (!title) {
                showToast('Please enter quest title', 'error');
                return;
            }
            
            state.quests.push({
                id: Date.now(),
                title,
                subject,
                completed: false,
                createdAt: new Date().toISOString()
            });
            
            saveState();
            closeModal('questModal');
            renderQuests();
            showToast('Quest added!', 'success');
        }

        function completeQuest(id) {
            const quest = state.quests.find(q => q.id === id);
            if (quest && !quest.completed) {
                quest.completed = true;
                quest.completedAt = new Date().toISOString();
                
                // Award exactly 20 XP and 5 Gold
                modifyXP(20, `Quest: ${quest.title}`);
                
                saveState();
                renderQuests();
                showToast('+20 XP, +5 Gold for quest!', 'success');
                checkRewards();
            }
        }

        function deleteQuest(id) {
            state.quests = state.quests.filter(q => q.id !== id);
            saveState();
            renderQuests();
        }

        // ===== HABITS =====
        function openHabitModal() {
            document.getElementById('habitName').value = '';
            openModal('habitModal');
        }

        function addHabit() {
            const name = document.getElementById('habitName').value;
            const category = document.getElementById('habitCategory').value;
            
            if (!name) {
                showToast('Please enter habit name', 'error');
                return;
            }
            
            state.habits.push({
                id: Date.now(),
                name,
                category,
                streak: 0,
                lastCompleted: null,
                createdAt: new Date().toISOString()
            });
            
            // Award 20 XP for creating habit
            modifyXP(20, `New Habit: ${name}`);
            
            saveState();
            closeModal('habitModal');
            renderHabits();
            showToast('+20 XP, +5 Gold for new habit!', 'success');
        }

        function completeHabit(id) {
            const habit = state.habits.find(h => h.id === id);
            const today = getDateString();
            
            if (habit && habit.lastCompleted !== today) {
                habit.lastCompleted = today;
                habit.streak++;
                saveState();
                renderHabits();
                showToast(`${habit.name} streak: ${habit.streak} days!`, 'success');
            }
        }

        function deleteHabit(id) {
            state.habits = state.habits.filter(h => h.id !== id);
            saveState();
            renderHabits();
        }

        // ===== MOCKS =====
        let mockCameraStream = null;
        let mockPhoto = null;

        function openDailyMockModal() {
            if (state.todayMockDone) {
                showToast('Daily mock already completed!', 'warning');
                return;
            }
            
            document.getElementById('mockModalSubject').textContent = state.dailyMockSubject;
            document.getElementById('mockDuration').value = '';
            document.getElementById('mockScore').value = '';
            document.getElementById('mockWeakArea').value = '';
            document.getElementById('mockCorrectionPlan').value = '';
            document.getElementById('mockCapturedPhoto').classList.add('hidden');
            document.getElementById('mockCameraPreview').classList.remove('hidden');
            mockPhoto = null;
            
            openModal('dailyMockModal');
            startCamera('mockCameraPreview', 'mockCameraOverlay');
        }

        function captureMockPhoto() {
            const video = document.getElementById('mockCameraPreview');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            mockPhoto = canvas.toDataURL('image/jpeg', 0.7);
            
            document.getElementById('mockCapturedPhoto').src = mockPhoto;
            document.getElementById('mockCapturedPhoto').classList.remove('hidden');
            video.classList.add('hidden');
            document.getElementById('mockCaptureBtn').textContent = 'Retake Photo';
            
            stopCamera();
        }

        function submitDailyMock() {
            const duration = parseInt(document.getElementById('mockDuration').value);
            const score = document.getElementById('mockScore').value;
            const weakArea = document.getElementById('mockWeakArea').value;
            const plan = document.getElementById('mockCorrectionPlan').value;
            
            if (!mockPhoto || !duration || !weakArea || !plan) {
                showToast('Please complete all fields with photo proof', 'error');
                return;
            }
            
            const xpEarned = Math.floor((duration / 60) * 30); // Mock Attempt rate
            const goldEarned = calculateGold(xpEarned);
            
            const mock = {
                id: Date.now(),
                type: 'daily',
                subject: state.dailyMockSubject,
                date: new Date().toISOString(),
                duration,
                score,
                weakArea,
                plan,
                photo: mockPhoto,
                xp: xpEarned,
                gold: goldEarned
            };
            
            state.mocks.push(mock);
            state.todayMockDone = true;
            state.todayProtection = 'partial';
            state.lastMockDate = getDateString();
            state.lastDailyMockSubject = state.dailyMockSubject;
            
            modifyXP(xpEarned, `Daily Mock: ${state.dailyMockSubject}`);
            
            saveState();
            closeModal('dailyMockModal');
            renderAll();
            showToast(`Daily Mock Complete! +${xpEarned} XP`, 'success');
            checkRewards();
        }

        function openSectionalMockModal() {
            document.getElementById('sectionalDuration').value = '';
            document.getElementById('sectionalScore').value = '';
            document.getElementById('sectionalReflection').value = '';
            openModal('sectionalMockModal');
        }

        function submitSectionalMock() {
            const subject = document.getElementById('sectionalSubject').value;
            const duration = parseInt(document.getElementById('sectionalDuration').value);
            const score = document.getElementById('sectionalScore').value;
            const reflection = document.getElementById('sectionalReflection').value;
            
            if (!duration || !reflection) {
                showToast('Please fill required fields', 'error');
                return;
            }
            
            const xpEarned = Math.floor((duration / 60) * 30);
            const goldEarned = calculateGold(xpEarned);
            
            state.mocks.push({
                id: Date.now(),
                type: 'sectional',
                subject,
                date: new Date().toISOString(),
                duration,
                score,
                reflection,
                xp: xpEarned,
                gold: goldEarned
            });
            
            if (state.todayProtection === 'none') {
                state.todayProtection = 'partial';
            }
            
            modifyXP(xpEarned, `Sectional Mock: ${subject}`);
            
            saveState();
            closeModal('sectionalMockModal');
            renderMocks();
            showToast(`+${xpEarned} XP from sectional mock!`, 'success');
        }

        function openFullMockModal() {
            document.getElementById('fullMockName').value = '';
            document.getElementById('fullMockDuration').value = '';
            document.getElementById('fullMockScore').value = '';
            document.getElementById('fullMockAnalysis').value = '';
            document.getElementById('fullMockLearnings').value = '';
            openModal('fullMockModal');
        }

        function submitFullMock() {
            const name = document.getElementById('fullMockName').value;
            const duration = parseInt(document.getElementById('fullMockDuration').value);
            const score = document.getElementById('fullMockScore').value;
            const analysis = document.getElementById('fullMockAnalysis').value;
            const learnings = document.getElementById('fullMockLearnings').value;
            
            if (!name || !duration || !analysis || !learnings) {
                showToast('Please complete all fields', 'error');
                return;
            }
            
            // Full mock gives higher XP
            const xpEarned = Math.floor((duration / 60) * 30) + 50; // Bonus for full mock
            const goldEarned = calculateGold(xpEarned);
            
            state.mocks.push({
                id: Date.now(),
                type: 'full',
                name,
                date: new Date().toISOString(),
                duration,
                score,
                analysis,
                learnings,
                xp: xpEarned,
                gold: goldEarned
            });
            
            state.todayProtection = 'full';
            state.lastMockDate = getDateString();
            
            modifyXP(xpEarned, `Full Mock: ${name}`);
            
            saveState();
            closeModal('fullMockModal');
            renderMocks();
            showToast(`‚öîÔ∏è Boss Battle Complete! +${xpEarned} XP`, 'success');
            checkRewards();
        }

        // ===== VISION =====
        let currentVisionType = 'vision';

        function openVisionModal(type) {
            currentVisionType = type;
            const title = type === 'vision' ? 'Edit Vision' : 'Edit Anti-Vision';
            const label = type === 'vision' ? 'Your Vision - Why are you preparing?' : 'Your Anti-Vision - What if you fail?';
            
            document.getElementById('visionModalTitle').textContent = title;
            document.getElementById('visionModalLabel').textContent = label;
            document.getElementById('visionInput').value = type === 'vision' ? state.vision : state.antiVision;
            
            openModal('visionModal');
        }

        function saveVision() {
            const text = document.getElementById('visionInput').value;
            if (currentVisionType === 'vision') {
                state.vision = text;
            } else {
                state.antiVision = text;
            }
            saveState();
            closeModal('visionModal');
            renderAwakening();
            showToast('Vision updated!', 'success');
        }

        // ===== SKILL TREES =====
        function setupSkillTabs() {
            document.querySelectorAll('.skill-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.skill-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    renderSkillTree();
                });
            });
        }

        function renderSkillTree() {
            const activeTab = document.querySelector('.skill-tab.active');
            const subject = activeTab ? activeTab.dataset.subject : 'Quantitative Aptitude';
            const skill = state.skills[subject] || { hours: 0, level: 1 };
            
            const topics = getTopicsForSubject(subject);
            
            document.getElementById('skillContent').innerHTML = `
                <div class="card">
                    <div class="skill-node">
                        <div class="skill-icon">üìö</div>
                        <div class="skill-info">
                            <div class="skill-name">${subject}</div>
                            <div class="skill-hours">${skill.hours.toFixed(1)} hours studied</div>
                        </div>
                        <div class="skill-level">Lv. ${skill.level}</div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-header">
                            <span>Next Level</span>
                            <span>${(skill.hours % 5).toFixed(1)} / 5 hours</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${((skill.hours % 5) / 5) * 100}%"></div>
                        </div>
                    </div>
                </div>
                
                <h3 style="font-size: 1rem; margin: 20px 0 12px; color: var(--text-secondary)">Topic Breakdown</h3>
                ${topics.map(t => `
                    <div class="skill-node" style="padding: 12px">
                        <div class="skill-icon" style="width: 36px; height: 36px; font-size: 1rem">üìñ</div>
                        <div class="skill-info">
                            <div class="skill-name" style="font-size: 0.9rem">${t}</div>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function getTopicsForSubject(subject) {
            const topics = {
                'Quantitative Aptitude': ['Number System', 'Percentage', 'Ratio & Proportion', 'Profit & Loss', 'Time & Work', 'Time Speed Distance', 'SI & CI', 'Algebra', 'Geometry', 'Mensuration', 'Trigonometry', 'DI'],
                'English Language': ['Vocabulary', 'Grammar', 'Comprehension', 'Cloze Test', 'Error Spotting', 'Sentence Improvement', 'Para Jumbles', 'Idioms & Phrases', 'One Word Substitution', 'Synonyms & Antonyms'],
                'Reasoning Ability': ['Coding-Decoding', 'Analogy', 'Series', 'Classification', 'Blood Relations', 'Direction Sense', 'Syllogism', 'Statement Conclusion', 'Venn Diagram', 'Puzzles', 'Seating Arrangement'],
                'General Awareness': ['History', 'Geography', 'Polity', 'Economics', 'Science', 'Current Affairs', 'Static GK', 'Important Days', 'Awards & Honours', 'Books & Authors']
            };
            return topics[subject] || [];
        }

        // ===== REWARDS =====
        function checkRewards() {
            const completedQuests = state.quests.filter(q => q.completed).length;
            const fullMocks = state.mocks.filter(m => m.type === 'full').length;
            const rank = getRank();
            
            REWARDS.forEach(reward => {
                if (state.unlockedRewards.includes(reward.id)) return;
                
                let unlocked = false;
                
                switch (reward.requirement) {
                    case 'firstStudy':
                        unlocked = state.studySessions.length > 0;
                        break;
                    case 'quests10':
                        unlocked = completedQuests >= 10;
                        break;
                    case 'streak7':
                        unlocked = state.streak >= 7 || state.bestStreak >= 7;
                        break;
                    case 'xp100':
                        unlocked = state.xp >= 100;
                        break;
                    case 'mocks5':
                        unlocked = fullMocks >= 5;
                        break;
                    case 'subject10h':
                        unlocked = Object.values(state.skills).some(s => s.hours >= 10);
                        break;
                    case 'level5':
                        unlocked = state.level >= 5;
                        break;
                    case 'rankD':
                        unlocked = rank.rank >= 'D' && rank.rank !== 'E';
                        break;
                    case 'streak30':
                        unlocked = state.streak >= 30 || state.bestStreak >= 30;
                        break;
                    case 'rankS':
                        unlocked = rank.rank === 'S';
                        break;
                }
                
                if (unlocked) {
                    state.unlockedRewards.push(reward.id);
                    saveState();
                    showToast(`üèÜ Reward Unlocked: ${reward.name}!`, 'success');
                }
            });
        }

        // ===== RENDER FUNCTIONS =====
        function renderAll() {
            renderDashboard();
            renderStudyHistory();
            renderQuests();
            renderHabits();
            renderMocks();
            renderRewards();
            renderAwakening();
            renderReport();
        }

        function renderDashboard() {
            const rank = getRank();
            const xpProgress = getXPToNextLevel();
            const totalHours = state.studySessions.reduce((sum, s) => sum + s.actualDuration, 0) / 60;
            
            document.getElementById('headerExam').textContent = `${state.exam} Preparation`;
            document.getElementById('headerXP').textContent = state.xp;
            document.getElementById('headerGold').textContent = getTotalGold();
            
            document.getElementById('rankBadge').textContent = rank.rank;
            document.getElementById('rankTitle').textContent = rank.title;
            document.getElementById('levelDisplay').textContent = `Level ${state.level}`;
            
            document.getElementById('dailyMockSubject').textContent = state.dailyMockSubject || 'Loading...';
            document.getElementById('dailyMockStatus').innerHTML = state.todayMockDone 
                ? '<span class="badge-green card-badge">‚úì Completed</span>'
                : '<button class="btn btn-primary btn-sm" onclick="openDailyMockModal()">Complete Mock</button>';
            
            document.getElementById('totalXP').textContent = state.xp;
            document.getElementById('totalGold').textContent = getTotalGold();
            document.getElementById('studyHours').textContent = `${totalHours.toFixed(1)}h`;
            document.getElementById('weeklyXP').textContent = `${state.weeklyXP}/300`;
            
            document.getElementById('xpToNext').textContent = `${xpProgress.current} / ${xpProgress.needed} XP`;
            document.getElementById('xpProgressBar').style.width = `${(xpProgress.current / xpProgress.needed) * 100}%`;
            
            document.getElementById('streakCount').textContent = state.streak;
            document.getElementById('failureCount').textContent = state.failureCount;
            document.getElementById('protectionStatus').textContent = 
                state.todayProtection === 'full' ? 'üõ°Ô∏è' : 
                state.todayProtection === 'partial' ? 'üî∞' : '‚ùå';
        }

        function renderStudyHistory() {
            const container = document.getElementById('studyHistory');
            const recent = state.studySessions.slice(-5).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>
                        <h3>No study sessions yet</h3>
                        <p>Start your first verified study session above</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recent.map(s => `
                <div class="history-item">
                    <div class="history-header">
                        <span class="history-date">${new Date(s.date).toLocaleDateString()}</span>
                        <span class="history-xp">+${s.xp} XP</span>
                    </div>
                    <div class="history-subject">${s.subject}</div>
                    <div class="history-details">${s.topic} ‚Ä¢ ${s.phase} ‚Ä¢ ${s.actualDuration} min</div>
                </div>
            `).join('');
        }

        function renderQuests() {
            const container = document.getElementById('questList');
            const pending = state.quests.filter(q => !q.completed);
            const completed = state.quests.filter(q => q.completed).slice(-5);
            
            if (state.quests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/></svg>
                        <h3>No quests yet</h3>
                        <p>Create study tasks to earn XP & Gold</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            if (pending.length > 0) {
                html += '<h3 style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 12px">Active Quests</h3>';
                html += pending.map(q => `
                    <div class="list-item">
                        <div class="list-checkbox" onclick="completeQuest(${q.id})">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20,6 9,17 4,12"/></svg>
                        </div>
                        <div class="list-content">
                            <div class="list-title">${q.title}</div>
                            <div class="list-meta">${q.subject} ‚Ä¢ 20 XP, 5 Gold</div>
                        </div>
                        <div class="list-action" onclick="deleteQuest(${q.id})">√ó</div>
                    </div>
                `).join('');
            }
            
            if (completed.length > 0) {
                html += '<h3 style="font-size: 0.9rem; color: var(--text-muted); margin: 20px 0 12px">Completed</h3>';
                html += completed.reverse().map(q => `
                    <div class="list-item completed">
                        <div class="list-checkbox checked">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20,6 9,17 4,12"/></svg>
                        </div>
                        <div class="list-content">
                            <div class="list-title">${q.title}</div>
                            <div class="list-meta">${q.subject}</div>
                        </div>
                    </div>
                `).join('');
            }
            
            container.innerHTML = html;
        }

        function renderHabits() {
            const container = document.getElementById('habitList');
            const today = getDateString();
            
            if (state.habits.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg>
                        <h3>No habits yet</h3>
                        <p>Create daily habits to build consistency</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = state.habits.map(h => {
                const completedToday = h.lastCompleted === today;
                return `
                    <div class="list-item ${completedToday ? 'completed' : ''}">
                        <div class="list-checkbox ${completedToday ? 'checked' : ''}" onclick="completeHabit(${h.id})">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20,6 9,17 4,12"/></svg>
                        </div>
                        <div class="list-content">
                            <div class="list-title">${h.name}</div>
                            <div class="list-meta">${h.category} ‚Ä¢ üî• ${h.streak} day streak</div>
                        </div>
                        <div class="list-action" onclick="deleteHabit(${h.id})">√ó</div>
                    </div>
                `;
            }).join('');
        }

        function renderMocks() {
            const container = document.getElementById('mockHistory');
            const recent = state.mocks.slice(-10).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>
                        <h3>No mocks completed</h3>
                        <p>Attempt mocks to earn XP and rank protection</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recent.map(m => `
                <div class="history-item">
                    <div class="history-header">
                        <span class="history-date">${new Date(m.date).toLocaleDateString()}</span>
                        <span class="history-xp">+${m.xp} XP</span>
                    </div>
                    <div class="history-subject">${m.type === 'full' ? '‚öîÔ∏è ' : ''}${m.subject || m.name}</div>
                    <div class="history-details">${m.type.charAt(0).toUpperCase() + m.type.slice(1)} Mock ‚Ä¢ ${m.duration} min${m.score ? ' ‚Ä¢ ' + m.score : ''}</div>
                </div>
            `).join('');
        }

        function renderRewards() {
            const container = document.getElementById('rewardsList');
            
            container.innerHTML = REWARDS.map(r => {
                const unlocked = state.unlockedRewards.includes(r.id);
                return `
                    <div class="reward-item ${unlocked ? 'unlocked' : 'locked'}">
                        <div class="reward-icon">${r.icon}</div>
                        <div class="reward-info">
                            <div class="reward-name">${r.name}</div>
                            <div class="reward-desc">${r.desc}</div>
                        </div>
                        <div class="reward-cost">${unlocked ? '‚úì' : 'üîí'}</div>
                    </div>
                `;
            }).join('');
        }

        function renderAwakening() {
            document.getElementById('visionText').textContent = state.vision || 'Click to set your vision...';
            document.getElementById('antiVisionText').textContent = state.antiVision || 'What happens if you fail...';
            
            if (state.startDate) {
                document.getElementById('journeyStart').textContent = new Date(state.startDate).toLocaleDateString();
                const days = Math.floor((Date.now() - new Date(state.startDate)) / (1000 * 60 * 60 * 24));
                document.getElementById('daysActive').textContent = days;
            }
            document.getElementById('bestStreak').textContent = `${state.bestStreak} days`;
        }

        function renderReport() {
            const rank = getRank();
            const totalHours = state.studySessions.reduce((sum, s) => sum + s.actualDuration, 0) / 60;
            
            document.getElementById('reportStartDate').textContent = state.startDate ? new Date(state.startDate).toLocaleDateString() : '-';
            document.getElementById('reportLevel').textContent = state.level;
            document.getElementById('reportRank').textContent = `${rank.rank} - ${rank.title}`;
            document.getElementById('reportXP').textContent = state.xp;
            document.getElementById('reportGold').textContent = getTotalGold();
            document.getElementById('reportStreak').textContent = state.streak;
            document.getElementById('reportFailures').textContent = state.failureCount;
            document.getElementById('reportHours').textContent = totalHours.toFixed(1);
            
            // Full history
            const container = document.getElementById('fullHistory');
            const allSessions = [...state.studySessions].reverse();
            
            if (allSessions.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">No study sessions recorded yet.</p>';
                return;
            }
            
            container.innerHTML = allSessions.map(s => `
                <div class="history-item">
                    <div class="history-header">
                        <span class="history-date">${new Date(s.date).toLocaleString()}</span>
                        <span class="history-xp">+${s.xp} XP, +${s.gold} Gold</span>
                    </div>
                    <div class="history-subject">${s.subject} - ${s.topic}</div>
                    <div class="history-details">
                        ${s.phase} ‚Ä¢ Expected: ${s.expectedDuration}min, Actual: ${s.actualDuration}min
                    </div>
                    <div class="history-details" style="margin-top: 8px; font-style: italic;">
                        "${s.reflection.content.substring(0, 100)}${s.reflection.content.length > 100 ? '...' : ''}"
                    </div>
                </div>
            `).join('');
        }

        // ===== PDF EXPORT =====
        function exportPDF() {
            const rank = getRank();
            const totalHours = state.studySessions.reduce((sum, s) => sum + s.actualDuration, 0) / 60;
            const completedQuests = state.quests.filter(q => q.completed).length;
            
            let content = `
                <html>
                <head>
                    <title>SSC Solo Leveling - Study Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 40px; color: #333; }
                        h1 { color: #1a1a2e; border-bottom: 2px solid #4a9eff; padding-bottom: 10px; }
                        h2 { color: #4a9eff; margin-top: 30px; }
                        .summary { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; }
                        .row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #ddd; }
                        .session { background: #fff; border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; }
                        .session-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
                        .xp { color: #4a9eff; font-weight: bold; }
                        .gold { color: #fbbf24; font-weight: bold; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
                        th { background: #f0f0f0; }
                        .footer { margin-top: 40px; text-align: center; color: #666; font-size: 12px; }
                    </style>
                </head>
                <body>
                    <h1>üìö SSC Solo Leveling - Professional Study Report</h1>
                    <p>Generated: ${new Date().toLocaleString()}</p>
                    
                    <div class="summary">
                        <div class="row"><span>Exam Target</span><strong>${state.exam}</strong></div>
                        <div class="row"><span>Tracking Since</span><strong>${new Date(state.startDate).toLocaleDateString()}</strong></div>
                        <div class="row"><span>Current Level</span><strong>${state.level}</strong></div>
                        <div class="row"><span>Current Rank</span><strong>${rank.rank} - ${rank.title}</strong></div>
                        <div class="row"><span>Total XP</span><strong class="xp">${state.xp}</strong></div>
                        <div class="row"><span>Total Gold</span><strong class="gold">${getTotalGold()}</strong></div>
                        <div class="row"><span>Current Streak</span><strong>${state.streak} days</strong></div>
                        <div class="row"><span>Best Streak</span><strong>${state.bestStreak} days</strong></div>
                        <div class="row"><span>Total Failures</span><strong>${state.failureCount}</strong></div>
                        <div class="row"><span>Verified Study Hours</span><strong>${totalHours.toFixed(1)} hours</strong></div>
                    </div>
                    
                    <h2>üìä Subject-wise Progress</h2>
                    <table>
                        <tr><th>Subject</th><th>Hours</th><th>Level</th></tr>
                        ${Object.entries(state.skills).map(([subj, data]) => `
                            <tr><td>${subj}</td><td>${data.hours.toFixed(1)}</td><td>${data.level}</td></tr>
                        `).join('')}
                    </table>
                    
                    <h2>üìù Verified Study Sessions (${state.studySessions.length} total)</h2>
                    ${state.studySessions.map(s => `
                        <div class="session">
                            <div class="session-header">
                                <span><strong>${s.subject}</strong> - ${s.topic}</span>
                                <span class="xp">+${s.xp} XP, +${s.gold} Gold</span>
                            </div>
                            <div>Date: ${new Date(s.date).toLocaleString()}</div>
                            <div>Phase: ${s.phase} | Duration: ${s.actualDuration} min (Expected: ${s.expectedDuration} min)</div>
                            <div style="margin-top: 8px; font-style: italic;">"${s.reflection.content}"</div>
                            <div style="font-size: 12px; color: #666;">Difficulty: ${s.reflection.difficulty} | Revision: ${s.reflection.revision}</div>
                        </div>
                    `).join('')}
                    
                    <h2>‚öîÔ∏è Mock Test History (${state.mocks.length} total)</h2>
                    ${state.mocks.length > 0 ? state.mocks.map(m => `
                        <div class="session">
                            <div class="session-header">
                                <span><strong>${m.type.toUpperCase()}</strong>: ${m.subject || m.name}</span>
                                <span class="xp">+${m.xp} XP</span>
                            </div>
                            <div>Date: ${new Date(m.date).toLocaleString()}</div>
                            <div>Duration: ${m.duration} min ${m.score ? '| Score: ' + m.score : ''}</div>
                            ${m.weakArea ? `<div>Weak Areas: ${m.weakArea}</div>` : ''}
                            ${m.plan ? `<div>Improvement Plan: ${m.plan}</div>` : ''}
                        </div>
                    `).join('') : '<p>No mocks recorded yet.</p>'}
                    
                    <h2>‚úÖ Quest Completion Log (${completedQuests}/${state.quests.length})</h2>
                    ${state.quests.filter(q => q.completed).map(q => `
                        <div class="session">
                            <div>${q.title}</div>
                            <div style="font-size: 12px; color: #666;">${q.subject} | Completed: ${new Date(q.completedAt).toLocaleDateString()}</div>
                        </div>
                    `).join('') || '<p>No quests completed yet.</p>'}
                    
                    <h2>üîÑ Habit Creation Log</h2>
                    ${state.habits.map(h => `
                        <div class="session">
                            <div>${h.name}</div>
                            <div style="font-size: 12px; color: #666;">${h.category} | Created: ${new Date(h.createdAt).toLocaleDateString()} | Current Streak: ${h.streak} days</div>
                        </div>
                    `).join('') || '<p>No habits created yet.</p>'}
                    
                    <h2>üéØ Vision</h2>
                    <div class="session">${state.vision || 'Not set'}</div>
                    
                    <h2>‚ö†Ô∏è Anti-Vision</h2>
                    <div class="session">${state.antiVision || 'Not set'}</div>
                    
                    <div class="footer">
                        <p>SSC Solo Leveling - Professional Study Tracker</p>
                        <p>Time = Effort | Proof = Accountability | Consistency = Rank</p>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(content);
            printWindow.document.close();
            printWindow.print();
        }

        // ===== INITIALIZE APP =====
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
